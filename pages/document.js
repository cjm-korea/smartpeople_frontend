import Animation from "@/components/animation";
import Layout from "@/components/layout";
import Head from "next/head";
import { useRouter } from "next/router";
import { useEffect, useState } from "react";
import Box from '@mui/material/Box';
import { DataGrid } from '@mui/x-data-grid';
import { rows } from "@/components/data/rows";
import { columns } from "@/components/data/columns";

export default function Document() {
    const router = useRouter();
    const [checkLogin, setCheckLogin] = useState(null)
    const [userData, setUserData] = useState(null)
    const isLoginURL = '/api/documentIsLogin'
    var token;

    useEffect(() => {
        if (typeof window !== 'undefined') {
            token = window.localStorage.getItem('jwt');
        } else {
            router.push({
                pathname: '/login'
            })
        }

        if (token) {
            async function fetchIsLogin() {
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': token,
                };
                const res = await fetch(isLoginURL, {
                    method: 'GET',
                    headers: headers
                })
                if (res.status !== 200) {
                    localStorage.removeItem('jwt');
                    router.push({
                        pathname: '/login'
                    })
                }
                setUserData(await res.json());
                setCheckLogin(res.status);
            }
            fetchIsLogin();
        }
    }, [])

    return (
        <Layout isLogIn={checkLogin}>
            <Head>
                <title>학원톡톡</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
            </Head>

            <section className="text-gray-600 body-font">
                <div className="container mx-auto flex px-5 py-12 md:flex-row flex-col items-center">
                    <div className="lg:flex-grow md:w-1/2 lg:pr-24 md:pr-16 flex flex-col md:items-start md:text-left mb-16 md:mb-0 items-center text-center">
                        <h1 className="title-font sm:text-4xl text-3xl mb-4 font-medium text-gray-900">어서오세요 {userData.userName}님.
                            {/* <br class="hidden lg:inline-block">readymade gluten/</br> */}
                        </h1>
                        <p className="mb-1 leading-relaxed">상호명: {userData.companyName}</p>
                        <p className="mb-1 leading-relaxed">위치: {userData.companyAddress}</p>
                        <p className="mb-1 leading-relaxed">번호: {userData.companyNumber}</p>
                        {/* <div className="flex justify-center">
                            <button className="inline-flex text-white bg-indigo-500 border-0 py-2 px-6 focus:outline-none hover:bg-indigo-600 rounded text-lg">연락하기</button>
                        </div> */}
                    </div>
                    <div className="lg:max-w-lg lg:w-full md:w-1/2 w-5/6">
                        <Animation />
                    </div>
                </div>
            </section>

            <section className="text-gray-600 body-font">
                <div className="container mx-auto flex px-5 py-12 md:flex-row flex-col items-center w-full">
                    <Box sx={{ height: 400, width: '100%' }}>
                        <DataGrid
                            // rows={Rows}
                            getRowId={(row) => row.userName}
                            rows={rows}
                            columns={columns}
                        />
                    </Box>
                </div>
            </section>
        </Layout>
    )

}

//   // This gets called on every request
// export async function getServerSideProps() {
//     const getUser = 'http://localhost:8000/auth/getUser'
//     var token = undefined;
//     var data = null;
//     if (typeof window !== 'undefined') {
//         token = window.localStorage.getItem('jwt');
//         const headers = {
//             'Content-Type': 'application/json',
//             Authorization: `Bearer ${token}`,
//         };
//         const res = await fetch(getUser,{
//             method: 'GET',
//             headers: headers
//         })
//         data = await res.json()
//         console.log(data);
//     }
//     console.log(token)
//     // appendData('test', 'test', 'test');
//     // Pass data to the page via props
//     return { props: { data } }
//   }